session和cookie的区别

模拟登陆、网站交互

```python
通过浏览器和后台
原理理解session和cookie的区别
cookie，浏览器支持的一种本地存储方式

通过resuest完成知乎的模拟登录



# 通过scrapy完成知乎的模拟登录

scrapy genspider zhihu www.zhihu.com


```







```python
#登录网址
https://accounts.douban.com/login?alias=13426039389&redir=https%3A%2F%2Fwww.douban.com&source=group&error=1012
    
豆瓣 豆瓣的post请求的邮箱和手机号的网址都一样（post到同一个url）
邮箱：手机号：
post
accounts.douban.com(127.0.0.1:55859)

参数：
form_email	27378892514@qq.com
form_password	zhangmengmeng

#name	value

login	登录 
redir	https://www.douban.com
source	group


取到以上参数，拿这些参数对服务器做一个post，做了post之后，服务器会给我们返回一个cookie，会告诉我们下一次登录的时候，会把哪些值带回来，带回来之后，我们就可以识别是哪一个用户。所以登录之后一定要把cookie保留下来，下一次请求页面的时候，就把cookie带回去

```

captcha-id

captcha-solution



```javascript
captcha-id  eVwJE0Mxss19J3mzT6SyB34j:en
captcha-solution error
form_email 13426039389
form_password zhangmengjie
login 登录
redir https://accounts.douban.com/
source None



captcha-id	Aakyg2VPwHLkWnrHYoEh4A6c:en
captcha-solution	sheep
form_email	13426039389
form_password	aaa
login	登录
redir	https://accounts.douban.com/
source	None
```

```python
使用pytesseract识别验证码







```





```python
模拟登陆还需要判断用户是否已经登录
用一个登陆之后能访问的页面来检测，如果返回的状态码为302（重定向到登录页面），则需要登陆
如果返回的页面是200 ，则是已经登录

```







https://www.douban.com/mine/wallet/





正则表达式默认只匹配一行

加参数 re.DOTALL  就会按照整个数据来匹配









https://www.zhihu.com/lives/827530183664861184/related









下拉刷新的如何爬取，怎样找规则

[https://api.zhihu.com/lives/827530183664861184/related?limit=5&offset=15]()

接口





https://www.zhihu.com/lives/901413690908241920

```python
def parse_answer(self,response):
        ans_json = json.loads(response.text)
        print(ans_json)
获取json数据
```

https://www.douban.com/misc/captcha?id=cZEtuAdeCsxoNXqlTd10bwic:en&size=s

https://www.douban.com/misc/captcha?id=jF2agnKrgdMF8x9Un7EIoenH:en&size=s

python3  ------  input

python2  ------  raw_input





id=        jF2agnKrgdMF8x9Un7EIoenH           :enz







yield 一个请求图片的request

保证在同一个cookie之下





callback很重要

在login中yield Request之后，在 login_after_captcha  里面请求url之后，和code是在同一个cookie

之下请求的



将图片验证码的过程放在了 login_after_captcha() 中了，  请过request请求的图片

如果请求图片直接在login中做， 不通过scrapy.Request来做的话，，登录会出错 

从response中拿到cookie，，然后把这个cookie设置到request中去

这样就可以保证两边的request是同一个session

参数通过meta 传递到response中去

meta={"post_data":'post_data'}



post_data = response.metaget(post_data)

得到图片yield给登陆之后，可以保证在同一个cookie之下







登录之后，再次请求会带去cookie和session 



异步的框架，所以必须yield出去  return出去的request没有用



相当于login往后延迟了一步，把验证码获取之后，在登录（保证在同一个COOKIE之下请求）





/html/body/div[2]/div/div[1]/div/span

































